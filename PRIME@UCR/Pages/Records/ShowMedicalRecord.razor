@page "/show-medical-record"
@using PRIME_UCR.Domain.Models.MedicalRecords
@using BlazorTable
@using MatBlazor;
@inject NavigationManager NavManager
@inject PRIME_UCR.Application.Services.MedicalRecords.IMedicalRecordService medical_record_service


<h3>Lista Expedientes Medicos</h3>

<style>
    body {
        background-color: white;
    }
</style>

    <Loading IsLoading="medical_records == null">
        <Table TableItem="Expediente" Items="medical_records" PageSize="5" @ref="MedicalRecordsModel" ColumnReorder="true" ShowSearchBar="true" class="table table-bordered">
            <Column TableItem="Expediente" Title="Numero Expediente" Field="@(x => x.Id)" Width="20%">
                <Template>
                    <a href="@get_record_link(context.Id)">@context.Id</a>
                </Template>
            </Column>

            <Column TableItem="Expediente" Title="Cédula" Field="@(x => x.CedulaPaciente)" Width="20%">
            </Column>

            <Column TableItem="Expediente" Title="Nombre" Field="@(x => x.Paciente.Nombre)" Width="20%">
            </Column>

            <Column TableItem="Expediente" Title="Primer Apellido" Field="@(x => x.Paciente.PrimerApellido)" Width="20%">
            </Column>

            <Column TableItem="Expediente" Title="Segundo Apellido" Field="@(x => x.Paciente.SegundoApellido)"  Width="20%">
            </Column>

            <Pager ShowPageNumber="true" ShowTotalCount="true" />
        </Table>
    </Loading>

@code {

    public List<Expediente> medical_records { get; set; }

    public ITable<Expediente> MedicalRecordsModel { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await get_records();
    }

    private async Task get_records()
    {
        IEnumerable<Expediente> records = await medical_record_service.GetAllAsync();
        medical_records = records.ToList();
    }

     public string get_record_link(int recordId)
    {
        return $"/medicalrecord/{recordId}";
    }
}