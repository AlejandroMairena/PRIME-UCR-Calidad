@using BlazorTable
@using PRIME_UCR.Domain.Models.Appointments
@inject IAppointmentService appointment_service


<style>
    body {
        background-color: white;
    }
</style>

<Loading IsLoading="medicalprescrip == null">
    <div class="prescriptions" style="resize:both">
        <Table TableItem="PoseeReceta" Items="medicalprescrip" PageSize="5" @ref="appointprescripModel" ColumnReorder="true" class="table table-bordered">
            <Column TableItem="PoseeReceta" Title="Medicamento" Field="@(x => x.RecetaMedica.NombreReceta)" Width="20%">
            </Column>

            <Column TableItem="PoseeReceta" Title="Prescripción" Field="@(x => x.Dosis)" Width="20%">
                <Template>
                    @if (context.Dosis == "")
                    {
                        <label for="texto1">Descripción</label>
                        <textarea name="texto1" @bind="prescription_text_area"></textarea>
                        <button @onclick="set_prescription_dosis">Guardar</button>
                    }
                    else
                    {
                        <p>@context.Dosis</p>
                    }

                </Template>
            </Column>

            <EmptyDataTemplate>
                <div class="text-center">
                    No existen medicamentos recetados.
                </div>
            </EmptyDataTemplate>
            <Pager ShowPageNumber="true" ShowTotalCount="true" />
        </Table>
    </div>
</Loading>



@code {

    [Parameter] public string AppointmentId { get; set; }

    public List<PoseeReceta> medicalprescrip { get; set; }

    public ITable<PoseeReceta> appointprescripModel { get; set; }

    public string prescription_text_area { get; set; }


    protected override async Task OnInitializedAsync()
    {
        await get_prescriptions();
    }


    public void set_prescription_dosis()
    {

    }


    private async Task get_prescriptions()
    {
        IEnumerable<PoseeReceta> records = await appointment_service.GetPrescriptionsByAppointmentId(Convert.ToInt32(AppointmentId));
        medicalprescrip = records.ToList();

    }

}
