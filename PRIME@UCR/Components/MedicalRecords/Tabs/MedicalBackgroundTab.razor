@attribute [Authorize]
@using BlazorTable
@using PRIME_UCR.Domain.Models.MedicalRecords
@inject IMedicalBackgroundService MedicalBackgroundService
@inject IAlergyService AllergyService
@inject IChronicConditionService ChronicConditionService

<h2>Antecedentes y Alergias</h2>
<div class="jumbotron white-panel">

    <Table TableItem="Antecedentes" Items="Antecedentes" PageSize="3" class="table table-bordered">
        <Column TableItem="Antecedentes" Title="Antecedentes del paciente" Field="@(x => x.ListaAntecedentes.NombreAntecedente)" Width="18%" />
        <EmptyDataTemplate>
            <div class="text-center">
                No se encontraron antecedentes registrados.
            </div>
        </EmptyDataTemplate>

        <Pager ShowPageNumber="true" ShowTotalCount="true" />
    </Table>
    <div>
        @if (backgroundAlreadyAdded)
        {
            <StatusMessage Message="Este antecedente ya fue agregado" Class="warning" />
        }
        @if (showBackground == true)
        {
            <EditForm EditContext="_contAnte">
                @* HAcer que el dropdown no muestre los qque ya estan*@
                <DropDownMenu T="ListaAntecedentes" Data="ListaAntecedentes"
                              Label="Antecedentes Médicos"
                              TextProperty="NombreAntecedente"
                              DefaultText="Seleccione un Antecedente"
                              Required="false"
                              Disabled="false"
                              @bind-Value="@antecedentePrueba" />
                <form>
                    @* Insert *@

                </form>
            </EditForm>
            <button type="submit" class="btn btn-primary mt-4 mb-4" @onclick="insertBackground">Guardar</button>
        }
        else
        {
            <button type="submit" class="btn btn-primary mt-4 mb-4" @onclick="showBackgroundOptions">Agregar antecedente</button>
        }

    </div>
</div>

<br>
<br>
<div class="jumbotron white-panel">
    <Table TableItem="Alergias" Items="Alergias" PageSize="3" class="table table-bordered">
        <Column TableItem="Alergias" Title="Alergias del paciente" Field="@(x => x.ListaAlergia.NombreAlergia)" Width="18%" />
        <EmptyDataTemplate>
            <div class="text-center">
                No se encontraron alergias registradas.
            </div>
        </EmptyDataTemplate>

        <Pager ShowPageNumber="true" ShowTotalCount="true" />
    </Table>
    <div>
        @if (allergyAlreadyAdded)
        {
            <StatusMessage Message="Esta alergia ya fue agregada" Class="warning" />
        }
        @if (showAllergy == true)
        {
            <EditForm EditContext="_contAle">
                <DropDownMenu T="ListaAlergia" Data="ListaAlergia"
                              Label="Alergias"
                              TextProperty="NombreAlergia"
                              DefaultText="Seleccione una alergia"
                              Required="false"
                              Disabled="false"
                              @bind-Value="@AlergiaPrueba" />
            </EditForm>
            <button type="submit" class="btn btn-primary mt-4 mb-4" @onclick="insertAllergy">Guardar</button>
        }
        else
        {
            <button type="submit" class="btn btn-primary mt-4 mb-4" @onclick="showAllergyOptions">Agregar alergia</button>
        }

    </div>
</div>
<div class="jumbotron white-panel">
    <Table TableItem="PadecimientosCronicos" Items="PadecimientosCronicos" PageSize="3" class="table table-bordered">
        <Column TableItem="PadecimientosCronicos" Title="Padecimientos Cronicos del paciente" Field="@(x => x.ListaPadecimiento.NombrePadecimiento)" Width="18%" />
        <EmptyDataTemplate>
            <div class="text-center">
                No se encontraron Padecimientos registradas.
            </div>
        </EmptyDataTemplate>

        <Pager ShowPageNumber="true" ShowTotalCount="true" />
    </Table>
    <div>
        @if (ChronicConditionAlreadyAdded)
        {
            <StatusMessage Message="Este Padecimiento ya fue agregado" Class="warning" />
        }
        @if (showChronicCondition == true)
        {
            <EditForm EditContext="_contCond">
                <DropDownMenu T="ListaPadecimiento" Data="ListaPadecimiento"
                              Label="Padecimientos"
                              TextProperty="NombrePadecimiento"
                              DefaultText="Seleccione un Padecimiento"
                              Required="false"
                              Disabled="false"
                              @bind-Value="@PadecimientoPrueba" />
            </EditForm>
            <button type="submit" class="btn btn-primary mt-4 mb-4" @onclick="insertChronicCondition">Guardar</button>
        }
        else
        {
            <button type="submit" class="btn btn-primary mt-4 mb-4" @onclick="showChronicConditionOptions">Agregar Padecimiento</button>
        }

    </div>
</div>